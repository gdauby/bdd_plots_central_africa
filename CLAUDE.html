<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • plotsdatabase</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">plotsdatabase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>

    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="development-workflow">Development Workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<p><strong>IMPORTANT: Always use feature branches for code changes</strong></p>
<p>When making any code modifications, follow this workflow:</p>
<ol style="list-style-type: decimal"><li>
<p><strong>Create a feature branch</strong> before making changes:</p>
<ul><li>Use descriptive branch names (e.g., <code>feature/add-new-query</code>, <code>fix/connection-bug</code>)</li>
</ul></li>
<li><p><strong>Make updates</strong> on the feature branch</p></li>
<li>
<p><strong>Before committing</strong>, <strong>ASK THE USER</strong> whether they want to update NEWS.md:</p>
<ul><li>If yes, add entry under the current development version section</li>
<li>Categorize changes appropriately:
<ul><li>
<strong>Breaking Changes</strong>: Changes that break backward compatibility</li>
<li>
<strong>New Features</strong>: New functionality added</li>
<li>
<strong>Bug Fixes</strong>: Fixes for existing issues</li>
<li>
<strong>Documentation</strong>: Documentation improvements</li>
<li>
<strong>Code Refactoring</strong>: Code organization improvements without functional changes</li>
<li>
<strong>Infrastructure</strong>: Development/build process changes</li>
</ul></li>
<li>Use bullet points with clear, concise descriptions</li>
<li>Reference issue numbers or PR numbers if applicable</li>
</ul></li>
<li><p><strong>Commit changes</strong> with clear, descriptive commit messages</p></li>
<li><p><strong>Create a pull request</strong> (optional, based on user request) back to master</p></li>
<li><p><strong>After merging to master</strong>: Ensure NEWS.md reflects all changes from the merged branch (if updated)</p></li>
</ol><p><strong>Never commit directly to master unless explicitly instructed by the user.</strong> <strong>Never automatically update NEWS.md - always ask the user first.</strong></p>
<div class="section level3">
<h3 id="newsmd-format">NEWS.md Format<a class="anchor" aria-label="anchor" href="#newsmd-format"></a></h3>
<p>The NEWS.md file follows standard R package changelog format:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu"># plotsdatabase NEWS</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">## plotsdatabase X.Y (Development/Release Date)</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">### Breaking Changes</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="ss">* </span>Description of breaking change</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">### New Features</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="ss">* </span>Description of new feature</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">### Bug Fixes</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="ss">* </span>Description of bug fix</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="fu">### Documentation</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="ss">* </span>Documentation improvements</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="fu">### Infrastructure</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="ss">* </span>Development process changes</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="repository-overview">Repository Overview<a class="anchor" aria-label="anchor" href="#repository-overview"></a></h2>
<p>This is <code>plotsdatabase</code>, an R package for exploring and updating a PostgreSQL database containing Central African forest plot and transect data. The package provides functions for querying plot data, individual tree measurements, taxonomic traits, and various ecological features.</p>
<p><strong>What this project does:</strong> - Query and analyze forest plot data from Central Africa - Access individual tree measurements and ecological features - Retrieve and aggregate species-level taxonomic traits - Update database tables with new measurements and observations - Resolve taxonomic synonyms and link trait data across hierarchy levels</p>
<p><strong>Access is restricted</strong> - requires database credentials.</p>
</div>
<div class="section level2">
<h2 id="technology-stack">Technology Stack<a class="anchor" aria-label="anchor" href="#technology-stack"></a></h2>
<p><strong>Core Technologies:</strong> - <strong>R</strong> (≥4.0) - Primary programming language - <strong>PostgreSQL</strong> - Two databases: <code>plots_transects</code> (main) and <code>rainbio</code> (taxa)</p>
<p><strong>Key R Package Dependencies:</strong> - <strong>DBI</strong> - Database interface abstraction - <strong>RPostgres</strong> - PostgreSQL connector - <strong>data.table</strong> - High-performance data manipulation</p>
<p><strong>Development Tools:</strong> - <strong>roxygen2</strong> (v7.3.2) - Automatic documentation generation from code comments - <strong>devtools</strong> - Package development workflow - <strong>RStudio</strong> - Recommended IDE</p>
<p><strong>Documentation &amp; Reporting:</strong> - <strong>RMarkdown</strong> - Interactive tutorials and reports - <strong>knitr</strong> - Document rendering</p>
<p><strong>Data Formats:</strong> - Excel (<code>.xlsx</code>) - Data imports/exports - GeoPackage (<code>.gpkg</code>) - Spatial/geographic data - CSV - Tabular data exchange</p>
<p><strong>Architecture Patterns:</strong> - Connection pooling for database efficiency - Row-level security policies for access control - Session-based credential caching - Layered query architecture (connection → fetch → enrich → aggregate → query)</p>
</div>
<div class="section level2">
<h2 id="core-architecture">Core Architecture<a class="anchor" aria-label="anchor" href="#core-architecture"></a></h2>
<div class="section level3">
<h3 id="database-connections">Database Connections<a class="anchor" aria-label="anchor" href="#database-connections"></a></h3>
<p>The package manages connections to <strong>two separate PostgreSQL databases</strong>:</p>
<ol style="list-style-type: decimal"><li>
<strong>Main database</strong> (<code>plots_transects</code>): Contains plot, subplot, and individual tree data</li>
<li>
<strong>Taxa database</strong> (<code>rainbio</code>): Contains taxonomic information and species-level traits (READ-ONLY for most users)</li>
</ol><p><strong>Connection management</strong> (<code>R/connections_db.R</code>): - Connections are stored in internal environment <code>.db_env</code> - Use <code><a href="reference/call.mydb.html">call.mydb()</a></code> for main database, <code><a href="reference/call.mydb.taxa.html">call.mydb.taxa()</a></code> for taxa database - Credentials cached in <code>credentials</code> environment during session - Connection pooling: functions check for existing valid connections before creating new ones - Use <code><a href="reference/cleanup_connections.html">cleanup_connections()</a></code> to close all connections and clear credentials</p>
<p><strong>Credential setup options</strong>: 1. Interactive prompts (default) 2. Store in <code>~/.Renviron</code> via <code><a href="reference/setup_db_credentials.html">setup_db_credentials()</a></code> (WARNING: plaintext storage) 3. Pass directly to connection functions</p>
</div>
<div class="section level3">
<h3 id="data-query-architecture">Data Query Architecture<a class="anchor" aria-label="anchor" href="#data-query-architecture"></a></h3>
<p>The package follows a <strong>layered query architecture</strong>:</p>
<ol style="list-style-type: decimal"><li>
<strong>Connection layer</strong>: <code><a href="reference/call.mydb.html">call.mydb()</a></code>, <code><a href="reference/call.mydb.taxa.html">call.mydb.taxa()</a></code>
</li>
<li>
<strong>Fetching layer</strong>: Low-level SQL queries (e.g., <code><a href="reference/fetch_taxa_trait_measurements.html">fetch_taxa_trait_measurements()</a></code>, <code><a href="reference/fetch_subplot_features.html">fetch_subplot_features()</a></code>)</li>
<li>
<strong>Enrichment layer</strong>: Add related data (e.g., <code><a href="reference/enrich_with_taxa_info.html">enrich_with_taxa_info()</a></code>, <code><a href="reference/enrich_individual_traits.html">enrich_individual_traits()</a></code>)</li>
<li>
<strong>Aggregation layer</strong>: Pivot/aggregate features (e.g., <code><a href="reference/aggregate_plot_features.html">aggregate_plot_features()</a></code>, <code><a href="reference/pivot_numeric_traits_generic.html">pivot_numeric_traits_generic()</a></code>)</li>
<li>
<strong>Query layer</strong>: High-level user-facing functions (e.g., <code><a href="reference/query_taxa_traits.html">query_taxa_traits()</a></code>, <code><a href="reference/query_plot_features.html">query_plot_features()</a></code>)</li>
</ol></div>
<div class="section level3">
<h3 id="key-data-structures">Key Data Structures<a class="anchor" aria-label="anchor" href="#key-data-structures"></a></h3>
<p><strong>Plot hierarchy</strong>: - <code>data_liste_plots</code> → <code>data_liste_sub_plots</code> → <code>data_ind_measures</code> (individual trees) - Plots contain subplots (census points, soil samples, etc.) - Subplots contain observations with features</p>
<p><strong>Traits hierarchy</strong>: - Taxa-level: <code>table_traits_measures</code> (species traits in taxa DB) - Individual-level: <code>data_ind_measures_feat</code> (tree-level measurements in main DB) - Both link to <code>table_traits</code> / <code>traitlist</code> for trait definitions</p>
<p><strong>Synonym resolution</strong>: - Taxa database contains <code>idtax_n</code> (taxon ID) and <code>idtax_good_n</code> (accepted taxon ID) - Use <code><a href="reference/resolve_taxon_synonyms.html">resolve_taxon_synonyms()</a></code> to consolidate traits from synonyms</p>
<p><strong>Database schema visualization</strong>: - Use <code><a href="reference/get_database_fk.html">get_database_fk()</a></code> (in <code>R/database_structure.R</code>) to visualize database structure - Generates diagram showing primary keys, foreign keys, and relationships between main tables - Covers key tables: plots, subplots, individuals, traits, and lookup tables - Requires <code>dm</code> package for relationship discovery and visualization</p>
</div>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="building-and-checking">Building and Checking<a class="anchor" aria-label="anchor" href="#building-and-checking"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">load_all</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Document functions (generate .Rd files from roxygen)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check package</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">check</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="database-connection-testing">Database Connection Testing<a class="anchor" aria-label="anchor" href="#database-connection-testing"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Test connections</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gdauby.github.io/bdd_plots_central_africa/">plotsdatabase</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/db_diagnostic.html">db_diagnostic</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Full diagnostic</span></span>
<span><span class="fu"><a href="reference/print_connection_status.html">print_connection_status</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Quick status check</span></span>
<span></span>
<span><span class="co"># Connect to databases</span></span>
<span><span class="va">con_main</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/call.mydb.html">call.mydb</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">con_taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/call.mydb.taxa.html">call.mydb.taxa</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize database structure</span></span>
<span><span class="fu"><a href="reference/get_database_fk.html">get_database_fk</a></span><span class="op">(</span><span class="va">con_main</span><span class="op">)</span>  <span class="co"># Shows primary/foreign key relationships</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="common-query-examples">Common Query Examples<a class="anchor" aria-label="anchor" href="#common-query-examples"></a></h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Query plots</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_plots.html">query_plots</a></span><span class="op">(</span>plot_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Query taxa-level traits</span></span>
<span><span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_taxa_traits.html">query_taxa_traits</a></span><span class="op">(</span></span>
<span>  idtax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12345</span>, <span class="fl">67890</span><span class="op">)</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"wide"</span>,</span>
<span>  add_taxa_info <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Query individual tree features</span></span>
<span><span class="va">indiv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/query_individual_features.html">query_individual_features</a></span><span class="op">(</span></span>
<span>  plot_ids <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  trait_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,  <span class="co"># Specific traits</span></span>
<span>  format <span class="op">=</span> <span class="st">"wide"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="repository-structure">Repository Structure<a class="anchor" aria-label="anchor" href="#repository-structure"></a></h2>
<div class="section level3">
<h3 id="folder-organization">Folder Organization<a class="anchor" aria-label="anchor" href="#folder-organization"></a></h3>
<p><strong><code>R/</code></strong> - Source code (all R function definitions)</p>
<p><em>Connection &amp; Database Management:</em> - <code>connections_db.R</code> - Database connection management, credentials, diagnostics, retry utilities - <code>database_structure.R</code> - Database schema visualization with <code><a href="reference/get_database_fk.html">get_database_fk()</a></code></p>
<p><em>Query Functions:</em> - <code>individual_features_function.R</code> - Individual tree measurements and traits queries - <code>subsplots_features_function.R</code> - Plot/subplot features and aggregation - <code>taxa_traits_function.R</code> - Species-level trait queries from taxa database</p>
<p><em>Taxonomic Functions:</em> - <code>taxonomic_query_functions.R</code> - Taxonomic queries with synonym resolution - <code>taxonomic_update_functions.R</code> - Taxonomic data updates and entry management</p>
<p><em>Update &amp; Delete Functions:</em> - <code>updates_tables_functions.R</code> - Database insert/update operations - <code>delete_functions.R</code> - Database deletion operations with cascade handling</p>
<p><em>Linking &amp; Matching:</em> - <code>link_table_functions.R</code> - Interactive data matching to lookup tables - <code>specimen_linking_functions.R</code> - Herbarium specimen linking to individuals</p>
<p><em>Data Processing &amp; Analysis:</em> - <code>growth_census_functions.R</code> - Growth computation and census analysis - <code>functions_divid_plot.R</code> - Plot division and spatial operations - <code>functions_manip_db.R</code> - General data processing utilities - <code>process_trimble_function.R</code> - GPS Trimble data processing</p>
<p><em>Helper Functions:</em> - <code>helpers_traits_common.R</code> - Generic trait aggregation functions - <code>helpers.R</code> - General utility functions (prompts, etc.) - <code>utils-pipe.R</code> - Pipe operator utilities</p>
<p><em>Interactive Applications:</em> - <code>shiny_app_taxo_match.R</code> - Shiny app for taxonomic matching</p>
<p><em>Package Data:</em> - <code>datasets.R</code> - Package dataset documentation</p>
<p><strong><code>man/</code></strong> - Documentation files (<code>.Rd</code> format) - Auto-generated from roxygen2 comments via <code>devtools::document()</code> - One <code>.Rd</code> file per exported function - Do not edit manually - modify roxygen comments in <code>R/</code> files instead</p>
<p><strong>Root directory:</strong> - <code>DESCRIPTION</code> - Package metadata (version, authors, dependencies) - <code>NAMESPACE</code> - Exported functions list (auto-generated) - <code>README.md</code> - Package overview and quick start guide - <code>CLAUDE.md</code> - This file (instructions for Claude Code) - <code>NEWS.md</code> - Version history and changelog - <code>.Rproj</code> - RStudio project configuration - <code>.gitignore</code> - Git ignore patterns (should include data files, outputs, cache)</p>
<p><strong>Note</strong>: The repository may contain working data files (<code>.xlsx</code>, <code>.gpkg</code>, <code>.csv</code>, <code>.html</code>, <code>.pdf</code>, etc.) that are NOT part of the package and should NOT be committed to version control. These should be in <code>.gitignore</code>.</p>
</div>
<div class="section level3">
<h3 id="primary-function-categories">Primary Function Categories<a class="anchor" aria-label="anchor" href="#primary-function-categories"></a></h3>
<p><strong>Connection &amp; Utilities</strong>: - <code>R/connections_db.R</code>: Database connection management, credential handling, diagnostics - <code><a href="reference/call.mydb.html">call.mydb()</a></code>, <code><a href="reference/call.mydb.taxa.html">call.mydb.taxa()</a></code> - Connection functions - <code><a href="reference/func_try_fetch.html">func_try_fetch()</a></code>, <code><a href="reference/try_open_postgres_table.html">try_open_postgres_table()</a></code> - Retry utilities - <code><a href="reference/db_diagnostic.html">db_diagnostic()</a></code>, <code><a href="reference/print_connection_status.html">print_connection_status()</a></code> - Diagnostics - <code>R/database_structure.R</code>: Database schema visualization - <code><a href="reference/get_database_fk.html">get_database_fk()</a></code> - Visualize database structure and relationships</p>
<p><strong>Querying Functions</strong>: - <code>R/individual_features_function.R</code>: Individual tree measurements and traits - <code><a href="reference/query_individual_features.html">query_individual_features()</a></code> - Main query function - <code>R/subsplots_features_function.R</code>: Plot-level features and subplot data - <code><a href="reference/query_plot_features.html">query_plot_features()</a></code>, <code>query_subplot_features()</code> - Feature queries - <code>R/taxa_traits_function.R</code>: Species-level trait queries from taxa database - <code><a href="reference/query_taxa_traits.html">query_taxa_traits()</a></code> - Main trait query function</p>
<p><strong>Taxonomic Functions</strong>: - <code>R/taxonomic_query_functions.R</code>: Taxonomic queries with synonym resolution - <code><a href="reference/query_taxa.html">query_taxa()</a></code>, <code><a href="reference/match_tax.html">match_tax()</a></code> - Taxonomy lookups - <code>R/taxonomic_update_functions.R</code>: Taxonomic data updates - <code><a href="reference/add_entry_taxa.html">add_entry_taxa()</a></code>, <code><a href="reference/update_taxa_link_table.html">update_taxa_link_table()</a></code> - Add/update taxa - <code><a href="reference/merge_individuals_taxa.html">merge_individuals_taxa()</a></code> - Merge individuals with taxonomy</p>
<p><strong>Update &amp; Delete Functions</strong>: - <code>R/updates_tables_functions.R</code>: Database insert/update operations - <code><a href="reference/add_sp_traits_measures.html">add_sp_traits_measures()</a></code>, <code><a href="reference/add_trait_taxa.html">add_trait_taxa()</a></code> - Add measurements/traits - <code>R/delete_functions.R</code>: Database deletion operations - <code><a href="reference/dot-delete_individuals.html">.delete_individuals()</a></code>, <code><a href="reference/dot-delete_entry_trait_measure.html">.delete_entry_trait_measure()</a></code> - Safe deletions with cascade handling</p>
<p><strong>Linking &amp; Specimen Management</strong>: - <code>R/link_table_functions.R</code>: Interactive data matching - <code><a href="reference/dot-link_table.html">.link_table()</a></code> - Interactive matching of values to lookup tables - <code><a href="reference/dot-find_cat.html">.find_cat()</a></code> - Fuzzy matching for categorical values - <code>R/specimen_linking_functions.R</code>: Herbarium specimen linking - <code><a href="reference/dot-add_link_specimens.html">.add_link_specimens()</a></code> - Link individuals to herbarium specimens - <code><a href="reference/get_ref_specimen_ind.html">get_ref_specimen_ind()</a></code> - Find reference specimens</p>
<p><strong>Data Processing &amp; Analysis</strong>: - <code>R/growth_census_functions.R</code>: Growth and census analysis - <code><a href="reference/growth_computing.html">growth_computing()</a></code> - Compute tree growth between censuses - <code>R/functions_divid_plot.R</code>: Plot division and spatial operations - <code>R/functions_manip_db.R</code>: General data processing utilities</p>
<p><strong>Helper Functions</strong>: - <code>R/helpers_traits_common.R</code>: Generic trait aggregation - <code><a href="reference/pivot_numeric_traits_generic.html">pivot_numeric_traits_generic()</a></code>, <code><a href="reference/pivot_categorical_traits_generic.html">pivot_categorical_traits_generic()</a></code> - <code>R/helpers.R</code>: General utilities - <code><a href="reference/choose_prompt.html">choose_prompt()</a></code> - Interactive user prompts</p>
</div>
<div class="section level3">
<h3 id="coding-conventions">Coding Conventions<a class="anchor" aria-label="anchor" href="#coding-conventions"></a></h3>
<p><strong>Helper Functions Pattern:</strong> - Internal helpers use <code>.</code> prefix (e.g., <code><a href="reference/dot-link_table.html">.link_table()</a></code>, <code>.add_modif_field()</code>, <code>.rename_data()</code>) - These are exported but intended for internal use or advanced users - Public-facing functions have descriptive names without prefix</p>
<p><strong>Generic Aggregation Functions:</strong> The package has refactored generic aggregation helpers in <code>R/helpers_traits_common.R</code>: - <code><a href="reference/pivot_numeric_traits_generic.html">pivot_numeric_traits_generic()</a></code>: Aggregate numeric traits with mean/sd/n - <code><a href="reference/pivot_categorical_traits_generic.html">pivot_categorical_traits_generic()</a></code>: Aggregate categorical traits (mode or concat) - <code><a href="reference/aggregate_plot_features.html">aggregate_plot_features()</a></code>: Aggregate multiple feature types for plots</p>
<p><strong>Standard R Package Structure:</strong> - Documentation lives in <code>man/</code> (generated, not manually edited) - Source code lives in <code>R/</code> - No <code>tests/</code> directory present (consider adding for production robustness) - No <code>vignettes/</code> directory (tutorials are in root as <code>.Rmd</code> files)</p>
</div>
</div>
<div class="section level2">
<h2 id="important-notes">Important Notes<a class="anchor" aria-label="anchor" href="#important-notes"></a></h2>
<div class="section level3">
<h3 id="database-write-operations">Database Write Operations<a class="anchor" aria-label="anchor" href="#database-write-operations"></a></h3>
<ul><li>
<strong>Taxa database is READ-ONLY</strong> for most users (verified on connect)</li>
<li>Write operations on main database require appropriate user permissions</li>
<li>Use <code><a href="reference/define_user_policy.html">define_user_policy()</a></code> for row-level security setup</li>
<li>Updates typically require <code>add_data = TRUE</code> parameter and user confirmation</li>
</ul></div>
<div class="section level3">
<h3 id="trait-value-types">Trait Value Types<a class="anchor" aria-label="anchor" href="#trait-value-types"></a></h3>
<p>Traits have <code>valuetype</code> field: - <code>"numeric"</code>: Stored in <code>traitvalue</code> column - <code>"categorical"</code>: Stored in <code>traitvalue_char</code> column - <code>"ordinal"</code>, <code>"character"</code>: Also use <code>traitvalue_char</code> - <code>"integer"</code>: Uses <code>traitvalue</code> (numeric) - <code>"table_colnam"</code>: References lookup table (treated as numeric ID)</p>
</div>
<div class="section level3">
<h3 id="categorical-aggregation-modes">Categorical Aggregation Modes<a class="anchor" aria-label="anchor" href="#categorical-aggregation-modes"></a></h3>
<p>When pivoting categorical traits to wide format: - <code>"mode"</code>: Most frequent value per taxon/individual - <code>"concat"</code>: All unique values concatenated</p>
</div>
<div class="section level3">
<h3 id="legacy-function-wrappers">Legacy Function Wrappers<a class="anchor" aria-label="anchor" href="#legacy-function-wrappers"></a></h3>
<p>Some functions have legacy wrappers for backward compatibility: - <code><a href="reference/query_traits_measures.html">query_traits_measures()</a></code> → wraps <code><a href="reference/query_taxa_traits.html">query_taxa_traits()</a></code> - These emit warnings suggesting migration to new functions</p>
</div>
</div>
<div class="section level2">
<h2 id="rmarkdown-tutorials">RMarkdown Tutorials<a class="anchor" aria-label="anchor" href="#rmarkdown-tutorials"></a></h2>
<p>The repository contains several <code>.Rmd</code> tutorial files (see <code>tuto_database.Rmd</code>, <code>tuto_db.Rmd</code>) which demonstrate package usage.</p>
</div>
<div class="section level2">
<h2 id="package-metadata">Package Metadata<a class="anchor" aria-label="anchor" href="#package-metadata"></a></h2>
<ul><li>
<strong>Version</strong>: 1</li>
<li>
<strong>Authors</strong>: Gilles Dauby, Hugo Leblanc</li>
<li>
<strong>License</strong>: GPL-2</li>
<li>
<strong>Minimum R version</strong>: 4.0</li>
<li>
<strong>roxygen2 version</strong>: 7.3.2</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Dauby.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

